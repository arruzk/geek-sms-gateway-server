## GEEK SMS gateway
Сервис предназначен для рассылки СМС сообщений, с использованием телефона с ОС Android.
Сервис состоит из 3-х частей:
- API
- Клиент для рассылки
- Admin UI для централизованного управления

#### Логика работы
Клиентское приложение после авторизации начинает опрашивать сервер на предмет наличия новых сообщений. 
В случай наличия сообщений - отправляет их. В дальнейшем можно будет прикрутить что-то типа Firebase.
При получении входящего сообщения - необходимо вызвать api. 
При измении статуса сообщения (доставка\ошибка при отправки) - необходимо вызвать api.

#### Авторизация
Авторизация происходит по протоколу JSON Web Token (JWT). При первом обращении передается логин-пароль, в случай успеха 
сервер возвращает токен. В первой версии не делаем устаревание токена.
Все вызовы api производятся с использование выданного токена. 
Токен должен передаваться в header запросов в поле **access-token**

#### Описание api
Все api в случай успеха возвращают код 200, в случай ошибки - 5ХХ (TODO)
##### Авторизация**

###### POST /api/v1/auth

* **Data Params**:
  * device_name
  * device_id (TODO можно ли что-то уникальное получить с девайса? Если нет, то при установке приложения генерить)
  * email
  * password

* **Success Responses**: TODO
```json
{
    "access_token": "token"
}
```

* **Failed Response**:
```json
{
  "error": "Wrong login/password"
}
```

###### GET /api/v1/messages-to-send
Метод служит для получения списка сообщения для отправки + передает информация о текущем состоянии устройства
* **Data Params**:
  * device_name
  * device_id
  * battery_level (уровень заряда)
  * queue_size (количество сообщений в очереди на отправку, можно не в первой версии)

* **Success Responses**:
```json
{
    "messages": [
      {
        "message_id": "GUID",
        "phone": "+79161111111",
        "message": "Sms message"
      },
      {
          "message_id": "GUID2",
          "phone": "+79162111111",
          "message": "Super sms message"
      }
    ]
}
```

* **Failed Response**: TODO
```json
{
  "error": "Wrong login/password"
}
```

###### POST /api/v1/message
Метод служит для доставки входящего сообщения на сервер 

* **Data Params**:
  * device_id
  * message
  * phone
  * timestamp (время получениия сообщения на телефон)
  * message_id (GUID, генерируется на клиенте и должен быть неизменен при многократном вызове api (например в случай ошибки))

* **Success Responses**:
```json
{
    "message_id": "GUID"
}
```

* **Failed Response**: TODO
```json
{
  "error": "Wrong login/password"
}
```

###### PATCH /api/v1/message
Метод служит для изменения статуса сообщения.
* **Data Params**:
  * device_id
  * message_id
  * timestamp
  * status
    * sent (произошла отправка)
    * delivered
    * error
  * error_message (заполняется только для статуса **error**)

* **Success Responses**:
200 код (TODO)

* **Failed Response**: TODO
```json
{
  "error": "Wrong login/password"
}
```

### Клиентское приложение для Android
В клиентском приложении необходимо иметь возможность просматривать 2 очереди сообщений и их статусы:

1. Исходящие сообщения
   * Статусы
     * В очереди (получено с сервера, но еще не отправлено)
     * Отправлено
     * Доставлено
     * Ошибка
1. Входящие сообщения
   * Статусы
     * На устройстве (TODO нормальное имя) (получено, но еще не отправлено на сервФер)
     * На сервер
    
Так же желательно в приложении видеть лог работы.
    
#### Настройки    
1. URL сервера
1. Логин\пароль для api
1. Частота опроста сервера

#### Потенциальные проблемы, которые необходимо учесть
1. Может быть не доступен сервер с api для отправки уведомления о входящем сообщеннии\измении статуса. 
В этом случае необходимо не потяерять эту информацию - складывать в очередь и отправлять позднее (+ уведомлять пользователя через вывод сообщения об ошибке) 
1. Не доступна мобильная сеть и не удается отправить сообщения - поведение такое же: ждем и уведомляем пользователя на телефоне.
В будущем нужно будет уведомлять сервер, на первую версию - без этого.
Необходимо различать различные типы ошибок (например - недоступность сети - ждем, ошибочный номер - отправляем на сервер сообщение об этом).
